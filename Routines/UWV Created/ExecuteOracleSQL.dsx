BEGIN HEADER
   CharacterSet "CP1252"
   ExportingTool "IBM InfoSphere DataStage Export"
   ToolVersion "8"
   ServerName "BE03QAP454UWVRM.HRC.BA.UWV.NL"
   ToolInstanceID "DIM_ontwikkel"
   MDISVersion "1.0"
   Date "2023-02-20"
   Time "13.05.05"
   ServerVersion "11.7"
END HEADER
BEGIN DSROUTINES
   BEGIN DSRECORD
      Identifier "ExecuteOracleSQL"
      DateModified "2023-02-20"
      TimeModified "12.50.50"
      OLEType "CRoutine"
      Readonly "0"
      Category "\\Routines\\UWV Created"
      ShortDesc "Execute any SQL statement passed from outside"
      Description =+=+=+=
This routine is configured to execute below type of SQL

1. SELECT with 1 row as result output
2. INSERT
3. UPDATE
=+=+=+=
      RoutineType "0"
      ArgCount "2"
      Built "1"
      SourceFlag "1"
      Vendor "Valcon"
      Author "Erik Paardekooper / William Beitler"
      Version "2.0.1"
      TestValues "etlo\(1B)dim_datastage\(9)dim_datastage_tns\(1B)dim_logging\(9)\"select  dim_logging.dl_run_id_sq.nextval from dual;\"\(1B)''\(9)\"select dim_snapshot_id, snapshot_datum, snapshot_datum_vanaf from  bdr_smz_sv_po.bdr_smz_sv_snapshot_dv where dim_snapshot_id = 20211226;\"\(1B)\(9)\"select dim_snapshot_id, snapshot_datum, snapshot_datum_vanaf from bdr_smz_sv_PM.bdr_smz_sv_snapshot_dv where periode_type= 'MAAND' and rownum < 5\"\(1B)\(9)select dim_snapshot_id, snapshot_datum, snapshot_datum_vanaf from bdr_smz_sv_PM.bdr_smz_sv_snapshot_dv where periode_type= 'MAAND' and rownum < 5\(1B)"
      Source =+=+=+=
FUNCTION ExecuteOracleSQL(pSqlstmt,pResult)
$INCLUDE DSINCLUDE JOBCONTROL.H
$INCLUDE UNIVERSE.INCLUDE ODBC.H

*-----------------------------------------------------------------------------------
* Sample SQL statement to be passed from sequence level
* ("select VOLGENDE_VERWERKINGSDATUM from DIM_LOGGING.etl_proces_status_tb where
* proces_naam=' :"'":pProcesNaam:"'" :';")
*-----------------------------------------------------------------------------------

      Ans = ''

*-----------------------------------------------------------------------------------
* Prepare the command statement to execute
*-----------------------------------------------------------------------------------

        cmd = 'echo -e '
        cmd = cmd : '"set pages 0\\n"'
        cmd = cmd : '"set newpage 0\\n"'
        cmd = cmd : '"set linesize 4000\\n"'
        cmd = cmd : '"set echo off\\n"'
        cmd = cmd : '"set headin off\\n"'
        cmd = cmd : '"set feedback off\\n"'
        cmd = cmd : '"set markup csv on delimiter | quote off\\n"'
        cmd = cmd : '"set trimout on\\n"'

*-----------------------------------------------------------------------------------
* Format pSqlStmt
*-----------------------------------------------------------------------------------

     pSqlstmtFmt = trim(pSqlstmt, char(34), 'B')
     pSqlstmtFmt = trim(pSqlstmtFmt , ';', 'B')
     pSqlstmtFmt = pSqlstmtFmt :';'
     pSqlstmtFmt = dquote(pSqlstmtFmt)

        cmd = cmd : pSqlstmtFmt 
        cmd = cmd : '| /w001/app/oracle/cl1/client/sqlplus -S /@dim_datastage_tns'

*-----------------------------------------------------------------------------------
* Execute the command, capture the output and check status
*-----------------------------------------------------------------------------------

      Call DSExecute("UNIX",cmd,output,status)
 
      if status <> 0
      then
         Call DSLogFatal('SQLPLUS error when executing following statement: ' , cmd)
      end

      Call DSLogInfo('Result is ' : output, DSJ.ME )

      Return(0)


RETURN(Ans)
=+=+=+=
      Catalog "DSU.ExecuteOracleSQL"
      JobType "0"
      Arguments "CRtnArgument"
      BEGIN DSSUBRECORD
         Name "pSqlstmt"
         SqlType "1"
         ColScale "0"
         IOType "0"
         Nullable "0"
         Occurs "0"
         KeyPosition "0"
         Precision "0"
         SignOption "0"
         SyncIndicator "0"
         LevelNo "0"
      END DSSUBRECORD
      BEGIN DSSUBRECORD
         Name "pResult"
         SqlType "1"
         ColScale "0"
         IOType "0"
         Nullable "0"
         Occurs "0"
         KeyPosition "0"
         Precision "0"
         SignOption "0"
         SyncIndicator "0"
         LevelNo "0"
      END DSSUBRECORD
      SkipOnNull "0"
      InvocationMethod "0"
   END DSRECORD
   BEGIN DSUBINARY
      Identifier "DSU.ExecuteOracleSQL"
      B1 "E1DA10B7050001003100030000000000170017004C004C0035001700FFFFFFFFE800000037000000"
      B41 "210000004B010000D06C00003C0100003C01000046030000A0070000E20700000000000000000000"
      B81 "08000000F80035002900F80036002A003A002A0037002A003A002A0038002A003A002A0039002A00"
      B121 "3A002A003A002A003A002A003B002A003A002A003C002A003A002A003D002A003A002A003E002A00"
      B161 "26003F0040004E023300400041002B004E022B00420041002B003A002B0042002B0040012B002B00"
      B201 "3A002A002B002A003A002A0043002A00F80045002C001E00440004002C002A002D002E0006012E00"
      B241 "46004000DE024000B8000000F80048002F001E00470002002F002A003A004A002D003000F8004B00"
      B281 "31001E004900020030003100F800460032005C01F800290032005C01F800350032005C0100656368"
      B321 "6F202D65202273657420706167657320305C6E2222736574206E65777061676520305C6E22227365"
      B361 "74206C696E6573697A6520343030305C6E2222736574206563686F206F66665C6E22227365742068"
      B401 "656164696E206F66665C6E222273657420666565646261636B206F66665C6E2222736574206D6172"
      B441 "6B757020637376206F6E2064656C696D69746572207C2071756F7465206F66665C6E222273657420"
      B481 "7472696D6F7574206F6E5C6E22423B7C202F773030312F6170702F6F7261636C652F636C312F636C"
      B521 "69656E742F73716C706C7573202D53202F4064696D5F6461746173746167655F746E734453457865"
      B561 "63757465554E495844534C6F67466174616C53514C504C5553206572726F72207768656E20657865"
      B601 "637574696E6720666F6C6C6F77696E672073746174656D656E743A2044534C6F67496E666F526573"
      B641 "756C7420697320010000000001000000010800000001000000010F00000009000000011100000018"
      B681 "00000001150000002900000001100000003E00000001120000004E00000001140000006000000001"
      B721 "2B0000007400000001120000009F000000032200000005000000000101000000B100000001010000"
      B761 "00B2000000013C000000B30000000409000000EF0000000104000000F80000000300000000040A00"
      B801 "0000FC000000013200000006010000040900000038010000010A0000004101000003010000000000"
      B841 "00000000000000000000080000000100010000000000100000000200010000000000180000000300"
      B881 "0100000000002000000004000100000000002A000000050001000000000033000000060001000000"
      B921 "00003D00000007000100000000004600000008000100000000004E00000009000100000000005800"
      B961 "00000A00010000000000680000000B00010000000000720000000C000100000000007C0000000D00"
      B1001 "010000000000840000000E000100000000008E0000000F0001000000000098000000100001000000"
      B1041 "0000A00000001100010000000000AD0000001200010000000000BA0000001300010000000000C400"
      B1081 "00001400010000000000D00000001500010000000000DE0000001600010000000000EA0000001700"
      B1121 "010000000000F20000001800010000000000FA0000001900010000000000050100001A0001000000"
      B1161 "00000B0100001B00010000000000150100001C00010000000000200100001D000100000000002A01"
      B1201 "00001E00010000000000350100001F000100000000003E0100002000010000000000430100002100"
      B1241 "0100000000004D010000220001000000000053010000230001000000000060010000240001000000"
      B1281 "00006701000025000100000000006F01000026000100000000007801000027000100000000008001"
      B1321 "000028000100000000008801000029000100000000008C0100002A00010000000000900100002B00"
      B1361 "0100000000009C0100002C00010000000000A30100002D00010000000000AA0100002E0001000000"
      B1401 "0000B10100002F00010000000000B80100003000010000000000BF0100003100010000000000C601"
      B1441 "00003200030000000000CD0100003300040000000000D60100003400030000000000244D41545249"
      B1481 "58004A6F624E616D65004572724D6F64650052746E4E616D65004A6F6248616E646C6500496E666F"
      B1521 "547970650053746167654E616D65004C696E6B4E616D65004576656E7449640052756E4E756D6265"
      B1561 "72004576656E745479706546696C746572004576656E745479706500537461727454696D6500456E"
      B1601 "6454696D65004D61784E756D62657200506172616D4E616D65005661724E616D650043757374496E"
      B1641 "666F4E616D65004576656E744D657373616765004D7367537472696E67005265706F72744C657665"
      B1681 "6C004C696E65536570617261746F72004D736754656D706C617465004172674C6973740052756E4D"
      B1721 "6F646500506172616D65746572730056616C7565004C696D697454797065004C696D697456616C75"
      B1761 "650051756575654E616D6500506172616D56616C75650056617256616C756500436F646500457272"
      B1801 "6F72436F6465004A6F6249440054726163654F7074696F6E7300706F72744E6F0054696D656F7574"
      B1841 "00537562724E616D650053756272417267004F7074696F6E7300416E7300636D64007053716C7374"
      B1881 "6D74466D74005F5430303031006F757470757400737461747573005F5430303032005F5430303033"
      B1921 "005F5430303034005F5430303030007053716C73746D740070526573756C7400F5FF0000FAFF0600"
      B1961 "06000800080008000800080008000800FAFF080010000A000800FEFF06000800FAFF0800FEFF1400"
      B2001 "FEFF1000FDFF1000FEFF1800FDFF080008002F773030312F7368617265645F686F742F50726F6A65"
      B2041 "6374732F44494D5F6F6E7477696B6B656C2F4453555F42502F4453552E457865637574654F726163"
      B2081 "6C6553514C0000"
   END DSUBINARY
END DSROUTINES
