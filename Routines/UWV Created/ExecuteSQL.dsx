BEGIN HEADER
   CharacterSet "CP1252"
   ExportingTool "IBM InfoSphere DataStage Export"
   ToolVersion "8"
   ServerName "BE03QAP454UWVRM.HRC.BA.UWV.NL"
   ToolInstanceID "DIM_ontwikkel"
   MDISVersion "1.0"
   Date "2022-08-08"
   Time "15.11.18"
   ServerVersion "11.7"
END HEADER
BEGIN DSROUTINES
   BEGIN DSRECORD
      Identifier "ExecuteSQL"
      DateModified "2022-06-02"
      TimeModified "14.50.05"
      OLEType "CRoutine"
      Readonly "0"
      Category "\\Routines\\UWV Created"
      ShortDesc "Execute any SQL statement passed from outside"
      Description =+=+=+=
This routine is configured to execute below type of SQL

1. SELECT with 1 row as result output
2. INSERT
3. UPDATE
=+=+=+=
      RoutineType "0"
      ArgCount "2"
      Built "1"
      SourceFlag "1"
      Vendor "Viqtor Davis B.V. N.L."
      Author "Nirakar"
      Version "2.0.0"
      TestValues "etlo\(1B)dim_datastage\(9)dim_datastage_tns\(1B)dim_logging\(9)\"select  dim_logging.dl_run_id_sq.nextval from dual;\"\(1B)''\(9)\"select PROCES_ID || '|' || PROCES_NAAM || '|' || to_char(VORIGE_VERWERKINGSDATUM, 'yyyy-mm-dd') from INT_UITKERINGSRECHT_SPECIFICATIE_PO.ETL_PROCES_STATUS_TB pr where pr.proces_naam = 'INT_URS_WIA'\"\(1B)\(9)\"select dim_snapshot_id||'   :\"'|'\":   '||snapshot_datum||'   :\"'|'\":   '||snapshot_datum_vanaf from  bdr_smz_sv_po.bdr_smz_sv_snapshot_dv where dim_snapshot_id = 20211226;\"\(1B)"
      Source =+=+=+=
FUNCTION ExecuteSQL(pSqlstmt,pResult)
$INCLUDE DSINCLUDE JOBCONTROL.H
$INCLUDE UNIVERSE.INCLUDE ODBC.H

*-----------------------------------------------------------------------------------
* Sample SQL statement to be passed from sequence level
* ('"select VOLGENDE_VERWERKINGSDATUM from DIM_LOGGING.etl_proces_status_tb where
* proces_naam=' :"'":pProcesNaam:"'" :';"')
*-----------------------------------------------------------------------------------

      Ans = ''

*-----------------------------------------------------------------------------------
* Prepare the command statement to execute
*-----------------------------------------------------------------------------------

        cmd = "/w001/app/oracle/cl1/client/sqlplus -S ": "/@dim_datastage_tns" : " <<< " :pSqlstmt
*       cmd = "sqlplus -S ": "/@dim_datastage_tns" : " <<< " :pSqlstmt

*-----------------------------------------------------------------------------------
* Execute the command, capture the output and check status
*-----------------------------------------------------------------------------------

      Call DSExecute("UNIX",cmd,output,status)
 


      if status <> 0
      then
         Call DSLogFatal('SQLPLUS error when executing following statement: ' : pSqlstmt)
      end

*-----------------------------------------------------------------------------------
* Delete last 2 blank lines
*-----------------------------------------------------------------------------------

      Del output<DCount( output, @FM )>
      Del output<DCount( output, @FM )>

*-----------------------------------------------------------------------------------
* Manupulation of the string to fetch the result
*-----------------------------------------------------------------------------------

      Convert @FM to '|' In output

      i_output   = Trim(Change(Trim(Change(output,'--','')),' ','|'), '|')
      d_count    = DCOUNT(i_output,'|')
      s_position = INDEX(i_output,'|',d_count/2)
      pResult    = TRIM(SUBSTRINGS(i_output,s_position +1,len(i_output) - s_position))


      Call DSLogInfo('Result is ' : pResult, DSJ.ME )

      Return(0)
RETURN(Ans)
=+=+=+=
      Catalog "DSU.ExecuteSQL"
      JobType "0"
      Arguments "CRtnArgument"
      BEGIN DSSUBRECORD
         Name "pSqlstmt"
         SqlType "1"
         ColScale "0"
         IOType "0"
         Nullable "0"
         Occurs "0"
         KeyPosition "0"
         Precision "0"
         SignOption "0"
         SyncIndicator "0"
         LevelNo "0"
      END DSSUBRECORD
      BEGIN DSSUBRECORD
         Name "pResult"
         SqlType "1"
         ColScale "0"
         IOType "0"
         Nullable "0"
         Occurs "0"
         KeyPosition "0"
         Precision "0"
         SignOption "0"
         SyncIndicator "0"
         LevelNo "0"
      END DSSUBRECORD
      SkipOnNull "0"
      InvocationMethod "0"
   END DSRECORD
   BEGIN DSUBINARY
      Identifier "DSU.ExecuteSQL"
      B1 "E1DA10B7050001003300030000000000180018004F004F0037001800FFFFFFFF2401000037000000"
      B41 "1A000000A10000005D9600007801000078010000C102000043070000770700000000000000000000"
      B81 "08000000F800370029003A00380035002A00F8003A002B001E00390004002B002A002C002D000601"
      B121 "2D003B003C00DE023C000000440000003A003E0035002E001E003D0001002E0026003F003C005000"
      B161 "2C003C0040005E002C0040003B003B002C0026003F00400050002C00400041005E002C0041003B00"
      B201 "3B002C0026003F0041003C00410042002C002C004B022C00430037003B003B004100B40141004400"
      B241 "4B024400450042003B003B0046004E024600420047002F0050002F00420030005A00300048004600"
      B281 "B4002F004200460031000400310049004600D0002F004A0094014A0031004B00F2012F0046004B00"
      B321 "4C00B4014C0036003A004E0036003200F800490033001E004D00020032003300F8003B0034005C01"
      B361 "F800290034005C01F800370034005C01002F773030312F6170702F6F7261636C652F636C312F636C"
      B401 "69656E742F73716C706C7573202D53202F4064696D5F6461746173746167655F746E73203C3C3C20"
      B441 "445345786563757465554E495844534C6F67466174616C53514C504C5553206572726F7220776865"
      B481 "6E20657865637574696E6720666F6C6C6F77696E672073746174656D656E743A207C2D2D20524453"
      B521 "4C6F67496E666F526573756C7420697320010000000001000000013F000000010000000409000000"
      B561 "4000000001040000004900000003000000000500000000040A0000004D0000000132000000570000"
      B601 "0003FE0000000501000000050200000001010000008900000001020000008A000000050300000001"
      B641 "010000008C000000050400000001010000008D000000030200000003010000000505000000050600"
      B681 "0000050700000004090000008E000000010A00000097000000000000000000000000000000080000"
      B721 "00010001000000000010000000020001000000000018000000030001000000000020000000040001"
      B761 "00000000002A00000005000100000000003300000006000100000000003D00000007000100000000"
      B801 "004600000008000100000000004E0000000900010000000000580000000A00010000000000680000"
      B841 "000B00010000000000720000000C000100000000007C0000000D00010000000000840000000E0001"
      B881 "00000000008E0000000F00010000000000980000001000010000000000A000000011000100000000"
      B921 "00AD0000001200010000000000BA0000001300010000000000C40000001400010000000000D00000"
      B961 "001500010000000000DE0000001600010000000000EA0000001700010000000000F2000000180001"
      B1001 "0000000000FA0000001900010000000000050100001A000100000000000B0100001B000100000000"
      B1041 "00150100001C00010000000000200100001D000100000000002A0100001E00010000000000350100"
      B1081 "001F000100000000003E01000020000100000000004301000021000100000000004D010000220001"
      B1121 "00000000005301000023000100000000006001000024000100000000006701000025000100000000"
      B1161 "006F0100002600010000000000780100002700010000000000800100002800010000000000880100"
      B1201 "0029000100000000008C0100002A00010000000000900100002B00010000000000970100002C0001"
      B1241 "00000000009E0100002D00010000000000A50100002E00010000000000AC0100002F000100000000"
      B1281 "00B50100003000010000000000BD0100003100010000000000C80100003200010000000000CF0100"
      B1321 "003300010000000000D60100003400030000000000DD0100003500040000000000E6010000360004"
      B1361 "0000000000244D4154524958004A6F624E616D65004572724D6F64650052746E4E616D65004A6F62"
      B1401 "48616E646C6500496E666F547970650053746167654E616D65004C696E6B4E616D65004576656E74"
      B1441 "49640052756E4E756D626572004576656E745479706546696C746572004576656E74547970650053"
      B1481 "7461727454696D6500456E6454696D65004D61784E756D62657200506172616D4E616D6500566172"
      B1521 "4E616D650043757374496E666F4E616D65004576656E744D657373616765004D7367537472696E67"
      B1561 "005265706F72744C6576656C004C696E65536570617261746F72004D736754656D706C6174650041"
      B1601 "72674C6973740052756E4D6F646500506172616D65746572730056616C7565004C696D6974547970"
      B1641 "65004C696D697456616C75650051756575654E616D6500506172616D56616C75650056617256616C"
      B1681 "756500436F6465004572726F72436F6465004A6F6249440054726163654F7074696F6E7300706F72"
      B1721 "744E6F0054696D656F757400537562724E616D650053756272417267004F7074696F6E7300416E73"
      B1761 "00636D64005F5430303031006F757470757400737461747573005F543030303200695F6F75747075"
      B1801 "7400645F636F756E7400735F706F736974696F6E005F5430303033005F5430303034005F54303030"
      B1841 "30007053716C73746D740070526573756C7400F5FF0000FAFF0600F9FF0800FCFF1400FEFF1200F9"
      B1881 "FF10001A00FAFF1A00FEFF10002C0008001200FDFF2600FEFF1800080008002F773030312F736861"
      B1921 "7265645F686F742F50726F6A656374732F44494D5F6F6E7477696B6B656C2F4453555F42502F4453"
      B1961 "552E4578656375746553514C0000"
   END DSUBINARY
END DSROUTINES
