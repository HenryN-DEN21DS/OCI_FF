BEGIN HEADER
   CharacterSet "CP1252"
   ExportingTool "IBM InfoSphere DataStage Export"
   ToolVersion "8"
   ServerName "BE03QAP454UWVRM.HRC.BA.UWV.NL"
   ToolInstanceID "DIM_ontwikkel"
   MDISVersion "1.0"
   Date "2021-06-03"
   Time "17.42.18"
   ServerVersion "11.7"
END HEADER
BEGIN DSROUTINES
   BEGIN DSRECORD
      Identifier "rtUtilityRunJob"
      DateModified "2021-06-01"
      TimeModified "14.28.14"
      OLEType "CRoutine"
      Readonly "0"
      Category "\\90 Generiek\\40 Test Raamwerk"
      ShortDesc "Run a job"
      Description =+=+=+=
The routine runs a job. Job parameters may be supplied. The result is a dynamic array containing the job status, and row count information for each link. The routine UtilityGetRunJobInfo can be used to interpret this result.

As well as the job name and job parameters, the routine parameters allow the job warning limit and row count limit to be set.

Format of returned dynamic array:
	
  Status<1>=Jobname=FinishStatus
  Status<2>=Jobname
  Status<3>=JobStartTimeStamp
  Status<4>=JobStopTimeStamp
  Status<5>=LinkNames  (value mark @VM delimited)
  Status<6>=RowCount   (value mark @VM delimited)
=+=+=+=
      RoutineType "0"
      ArgCount "4"
      Built "1"
      SourceFlag "1"
      Version "2.0.2"
      TestValues "\(1B)seq_DL_DetecteerPakbonEnLog\(1B)0\(1B)0"
      Source =+=+=+=
FUNCTION rtUtilityRunJob(Arg1,Arg2,Arg3,Arg4)
*
* Demonstrate how to run a job within the GUI development enviroment.  Arguments may
* be passed in. The result is a dynamic array with the resulting status and run 
* statistics (row counts for every link on every stage in the job)  
*

$INCLUDE DSINCLUDE JOBCONTROL.H

    Equate RoutineName To 'rtUtilityRunJob'
    Equate RunJobName to Arg1
    Equate Params To Arg2

    Dim Param(100,2) ;* Limited to max of 100 parameters 

    Deffun DSRMessage(A1, A2, A3) Calling "*DataStage*DSR_MESSAGE"
    Deffun DSRTimestamp Calling "DSR_TIMESTAMP"

    JobHandle = ''
    Info = ''

    ParamCount = Dcount(Params,'|')
    RowLimit = If Arg3 = '' Then 0 Else Arg3
    WarnLimit = If Arg4 = '' Then 0 Else Arg4

    For ParamNum = 1 to ParamCount
        ParamDesc = Field(Params, '|', ParamNum)
        Param(ParamNum,1) = Field(ParamDesc, '=', 1)
        Param(ParamNum,2) = Field(ParamDesc, '=', 2, Len(ParamDesc))
    Next ParamNum

* Reset job if status is not correct
   JobHandle = DSAttachJob(RunJobName, DSJ.ERRNONE) 

   JobStatus = DSGetJobInfo(JobHandle, DSJ.JOBSTATUS) 
   Call DSLogInfo("Jobstatus " : JobStatus, "rtUtilityRunJob") 
   If JobStatus <> DSJS.RUNOK
   Then 
       Call DSLogInfo("Resetting job " : DQuote(RunJobName), "rtUtilityRunJob") 
       ErrCode = DSRunJob(JobHandle, DSJ.RUNRESET) 
   End 
   ErrCode = DSDetachJob(JobHandle) 


*    JobHandle = DSAttachJob(RunJobName, DSJ.ERRFATAL)
*    ErrCode = DSRunJob(JobHandle, DSJ.RUNVALIDATE)
*    If ErrCode <> DSJS.RUNOK AND ErrCode <> DSJ.RUNRESET
*    Then
*      JobHandle = DSAttachJob(RunJobName, DSJ.ERRFATAL)
*      ErrCode = DSRunJob(JobHandle, DSJ.ERRNONE)
*    End
 
* Run job
    JobHandle = DSAttachJob(RunJobName, DSJ.ERRFATAL)
      
    Message = DSRMessage('DSTAGE_TRX_I_0014', 'Attaching job for processing - %1 - Status of Attachment = %2', RunJobName:@FM:JobHandle )
    Call DSLogInfo(Message, RoutineName)
    LimitErr = DSSetJobLimit(JobHandle, DSJ.LIMITROWS, RowLimit)
    LimitErr = DSSetJobLimit(JobHandle, DSJ.LIMITWARN, WarnLimit)

* Need to check if error occurred.
    ListOfParams = DSGetJobInfo(JobHandle, DSJ.PARAMLIST)
    ListCount = Dcount(ListOfParams,',')
    For ParamNum = 1 To ParamCount
 	Message = DSRMessage('DSTAGE_TRX_I_0015', 'Setting Job Param - %1  Setting to %2', Param(ParamNum,1):@FM:Param(ParamNum,2))
 	Call DSLogInfo(Message, RoutineName)
       ErrCode = DSSetParam(JobHandle, Param(ParamNum,1),Param(ParamNum,2))
    Next ParamNum

    ErrCode = DSRunJob(JobHandle, DSJ.RUNNORMAL)
    ErrCode = DSWaitForJob(JobHandle)

    Status = DSGetJobInfo(JobHandle, DSJ.JOBSTATUS)

    If Status = 1 
    Then
         Ans = 0 
    End
    Else
         Ans = 1
    End  

RETURN(Ans)
=+=+=+=
      Catalog "DSU.rtUtilityRunJob"
      JobType "0"
      Arguments "CRtnArgument"
      BEGIN DSSUBRECORD
         Name "Arg1"
         Desc "Job name"
         SqlType "0"
         ColScale "0"
         IOType "0"
         Nullable "0"
         Occurs "0"
         KeyPosition "0"
         Precision "0"
         SignOption "0"
         SyncIndicator "0"
         LevelNo "0"
      END DSSUBRECORD
      BEGIN DSSUBRECORD
         Name "Arg2"
         Desc "Job parameters, format Param1=Value1|Param2=Value2..."
         SqlType "0"
         ColScale "0"
         IOType "0"
         Nullable "0"
         Occurs "0"
         KeyPosition "0"
         Precision "0"
         SignOption "0"
         SyncIndicator "0"
         LevelNo "0"
      END DSSUBRECORD
      BEGIN DSSUBRECORD
         Name "Arg3"
         Desc "Row limit, 0 for unlimited"
         SqlType "0"
         ColScale "0"
         IOType "0"
         Nullable "0"
         Occurs "0"
         KeyPosition "0"
         Precision "0"
         SignOption "0"
         SyncIndicator "0"
         LevelNo "0"
      END DSSUBRECORD
      BEGIN DSSUBRECORD
         Name "Arg4"
         Desc "Warning limit, 0 for unlimited"
         SqlType "0"
         ColScale "0"
         IOType "0"
         Nullable "0"
         Occurs "0"
         KeyPosition "0"
         Precision "0"
         SignOption "0"
         SyncIndicator "0"
         LevelNo "0"
      END DSSUBRECORD
      SkipOnNull "0"
      InvocationMethod "0"
   END DSRECORD
   BEGIN DSUBINARY
      Identifier "DSU.rtUtilityRunJob"
      B1 "E1DA10B7050001004F00050000000000220022007700770055002200FD7F0000B202000053000000"
      B41 "370000001B0100007B5E000006030000060300001B050000D70B0000450C00000000000000000000"
      B81 "080000005600290055005600F80057000400F80057002D005000520058002E006E00530057005900"
      B121 "DE02590038000000F8005A002F00C2003E000000F80053002F006E00540057005900DE0259000000"
      B161 "5C000000F8005A003000C20062000000F80054003000F8005A003100980031002E005B00B8000000"
      B201 "84005200580031005B003200840032005C005B005B005900FC00590031005B002900D00032005900"
      B241 "840032005C00560059005D00FC005D00310056002900C20068000000F8005F00330096015E000200"
      B281 "510033000400F8005B0035009601600002000400350034003A00620034003600F800630037001E00"
      B321 "6100020036003700060134005B005D00DE025D00340100004001510065003A00640065003800F800"
      B361 "630039001E006100020038003900F80056003B0096016600020004003B003A009601670001000400"
      B401 "3A00F8005B003C0096015E00020051003C000400F80069003E00F8006A003F0026006B005D000401"
      B441 "030051005D00040040009601680003003E003F0040003D00F800630041001E00610002003D004100"
      B481 "F8005600430096016C000300040043002F004200F8005B00440096016C0003000400440030004200"
      B521 "F8006D004600960160000200040046004500500045006E004700F8005A003100980031002E005B00"
      B561 "50020000F8006F004800F80070004900E600290031005B00710026006B007200E600290031005600"
      B601 "7300040103007100720073004A00960168000300480049004A003D00F80063004B001E0061000200"
      B641 "3D004B0096017400030004000000290031005B0000002900310056003A00C200D4010000F8005B00"
      B681 "4C0096016600020004004C003A0096017500010004003A00F8005B004E0096016000020004004E00"
      B721 "4D006E004D005B007600DE02760000009C020000F8005A004F00C200A2020000F8005B004F00F800"
      B761 "4F0050005C01F800570050005C01007C3D44534174746163684A6F6244534765744A6F62496E666F"
      B801 "44534C6F67496E666F4A6F627374617475732072745574696C69747952756E4A6F62526573657474"
      B841 "696E67206A6F6220445352756E4A6F6244534465746163684A6F622A4461746153746167652A4453"
      B881 "525F4D4553534147454453544147455F5452585F495F30303134417474616368696E67206A6F6220"
      B921 "666F722070726F63657373696E67202D202531202D20537461747573206F66204174746163686D65"
      B961 "6E74203D20253244535365744A6F624C696D69742C4453544147455F5452585F495F303031355365"
      B1001 "7474696E67204A6F6220506172616D202D202531202053657474696E6720746F2025324453536574"
      B1041 "506172616D445357616974466F724A6F620364000000030200000001000000000100000001010000"
      B1081 "00010000000500000000030000000003010000000101000000020000000501000000040B00000003"
      B1121 "0000000303000000040C0000000E00000004090000001A000000010A00000023000000010F000000"
      B1161 "2D000000010E0000003C000000050200000004080000004A000000040B0000005200000004160000"
      B1201 "005D000000011100000073000000013D0000008400000003FE000000040D000000C1000000030600"
      B1241 "00000101000000CE0000000111000000CF0000000125000000E00000000503000000050400000005"
      B1281 "05000000040A00000005010000040C0000000F010000050600000000000000000000000000000008"
      B1321 "00000001000100000000001000000002000100000000001800000003000100000000002000000004"
      B1361 "000100000000002A00000005000100000000003300000006000100000000003D0000000700010000"
      B1401 "0000004600000008000100000000004E0000000900010000000000580000000A0001000000000068"
      B1441 "0000000B00010000000000720000000C000100000000007C0000000D00010000000000840000000E"
      B1481 "000100000000008E0000000F00010000000000980000001000010000000000A00000001100010000"
      B1521 "000000AD0000001200010000000000BA0000001300010000000000C40000001400010000000000D0"
      B1561 "0000001500010000000000DE0000001600010000000000EA0000001700010000000000F200000018"
      B1601 "00010000000000FA0000001900010000000000050100001A000100000000000B0100001B00010000"
      B1641 "000000150100001C00010000000000200100001D000100000000002A0100001E0001000000000035"
      B1681 "0100001F000100000000003E01000020000100000000004301000021000100000000004D01000022"
      B1721 "00010000000000530100002300010000000000600100002400010000000000670100002500010000"
      B1761 "0000006F010000260001000000000078010000270001000000000080010000280001000000000088"
      B1801 "01000029000700000000008E0100002A00010000000000910100002B00010000000000940100002C"
      B1841 "00010000000000970100002D000100000000009C0100002E00010000000000A70100002F00010000"
      B1881 "000000B00100003000010000000000BA0100003100010000000000C30100003200010000000000CD"
      B1921 "0100003300010000000000D40100003400010000000000DE0100003500010000000000E501000036"
      B1961 "00010000000000EC0100003700010000000000F30100003800010000000000FA0100003900010000"
      B2001 "000000010200003A00010000000000090200003B00010000000000100200003C0001000000000017"
      B2041 "0200003D000100000000001F0200003E00010000000000260200003F000100000000002D02000040"
      B2081 "000100000000003402000041000100000000003B0200004200010000000000440200004300010000"
      B2121 "0000004B02000044000100000000005202000045000100000000005F020000460001000000000066"
      B2161 "02000047000100000000007002000048000100000000007702000049000100000000007E0200004A"
      B2201 "00010000000000850200004B000100000000008C0200004C00010000000000930200004D00010000"
      B2241 "0000009A0200004E00010000000000A10200004F00010000000000A50200005000030000000000AC"
      B2281 "0200005100040000000000B10200005200040000000000B60200005300040000000000BB02000054"
      B2321 "00040000000000244D4154524958004A6F624E616D65004572724D6F64650052746E4E616D65004A"
      B2361 "6F6248616E646C6500496E666F547970650053746167654E616D65004C696E6B4E616D6500457665"
      B2401 "6E7449640052756E4E756D626572004576656E745479706546696C746572004576656E7454797065"
      B2441 "00537461727454696D6500456E6454696D65004D61784E756D62657200506172616D4E616D650056"
      B2481 "61724E616D650043757374496E666F4E616D65004576656E744D657373616765004D736753747269"
      B2521 "6E67005265706F72744C6576656C004C696E65536570617261746F72004D736754656D706C617465"
      B2561 "004172674C6973740052756E4D6F646500506172616D65746572730056616C7565004C696D697454"
      B2601 "797065004C696D697456616C75650051756575654E616D6500506172616D56616C75650056617256"
      B2641 "616C756500436F6465004572726F72436F6465004A6F6249440054726163654F7074696F6E730070"
      B2681 "6F72744E6F0054696D656F757400537562724E616D650053756272417267004F7074696F6E730050"
      B2721 "6172616D00413100413200413300496E666F00506172616D436F756E7400526F774C696D69740057"
      B2761 "61726E4C696D697400506172616D4E756D00506172616D44657363005F5430303031004A6F625374"
      B2801 "61747573005F5430303032005F5430303033005F5430303034005F5430303035005F543030303600"
      B2841 "457272436F6465005F5430303037005F5430303038004D657373616765005F5430303039005F5430"
      B2881 "303130005F5430303131005F5430303132004C696D6974457272005F5430303133005F5430303134"
      B2921 "004C6973744F66506172616D73005F5430303135004C697374436F756E74005F5430303136005F54"
      B2961 "30303137005F5430303138005F5430303139005F543030323000537461747573005F543030323100"
      B3001 "416E73005F5430303030004172673100417267320041726733004172673400F2FF0000FBFF080006"
      B3041 "00FEFF060008002200FEFF240012000C0016001C00FDFF0600FEFF120012001800FEFF10001E00FE"
      B3081 "FF1200F4FF0A00FEFF12002C0010001400FDFF1400120008001200400010001A00FEFF06001200FE"
      B3121 "FF0A00FEFF1200FEFF1200FDFF0C00FDFF060008002F773030312F7368617265645F686F742F5072"
      B3161 "6F6A656374732F44494D5F6F6E7477696B6B656C2F4453555F42502F4453552E72745574696C6974"
      B3201 "7952756E4A6F620000"
   END DSUBINARY
END DSROUTINES
